{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schemas.locus-proxmox.local/cluster-config.json",
  "title": "Proxmox Cluster Configuration",
  "description": "Schema for validating Proxmox cluster configuration",
  "type": "object",
  "required": ["cluster_name", "nodes"],
  "properties": {
    "cluster_name": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9-]+$",
      "minLength": 3,
      "maxLength": 30,
      "description": "Cluster name"
    },
    "nodes": {
      "type": "array",
      "minItems": 1,
      "maxItems": 32,
      "items": {
        "$ref": "#/definitions/node"
      },
      "description": "Cluster nodes"
    },
    "network": {
      "type": "object",
      "properties": {
        "cluster_network": {
          "type": "string",
          "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}/[0-9]{1,2}$",
          "description": "Cluster network (CIDR)"
        },
        "migration_network": {
          "type": "string",
          "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}/[0-9]{1,2}$",
          "description": "Migration network (CIDR)"
        }
      }
    },
    "storage": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/storage"
      },
      "description": "Shared storage configurations"
    },
    "backup": {
      "type": "object",
      "properties": {
        "schedule": {
          "type": "string",
          "pattern": "^[0-9*,/-]+ [0-9*,/-]+ [0-9*,/-]+ [0-9*,/-]+ [0-9*,/-]+$",
          "description": "Backup schedule (cron format)"
        },
        "retention": {
          "type": "object",
          "properties": {
            "daily": {
              "type": "integer",
              "minimum": 1,
              "maximum": 30,
              "default": 7
            },
            "weekly": {
              "type": "integer",
              "minimum": 1,
              "maximum": 12,
              "default": 4
            },
            "monthly": {
              "type": "integer",
              "minimum": 1,
              "maximum": 12,
              "default": 3
            }
          }
        },
        "storage": {
          "type": "string",
          "description": "Backup storage target"
        }
      },
      "required": ["schedule", "storage"]
    },
    "monitoring": {
      "type": "object",
      "properties": {
        "thresholds": {
          "type": "object",
          "properties": {
            "cpu": {
              "type": "integer",
              "minimum": 50,
              "maximum": 95,
              "default": 80
            },
            "memory": {
              "type": "integer",
              "minimum": 50,
              "maximum": 95,
              "default": 80
            },
            "storage": {
              "type": "integer",
              "minimum": 70,
              "maximum": 95,
              "default": 85
            }
          }
        },
        "alerts": {
          "type": "object",
          "properties": {
            "email": {
              "type": "array",
              "items": {
                "type": "string",
                "format": "email"
              }
            },
            "webhook": {
              "type": "string",
              "format": "uri"
            }
          }
        }
      }
    }
  },
  "definitions": {
    "node": {
      "type": "object",
      "required": ["name", "ip"],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9-]+$",
          "minLength": 3,
          "maxLength": 20,
          "description": "Node name"
        },
        "ip": {
          "type": "string",
          "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}$",
          "description": "Node IP address"
        },
        "role": {
          "type": "string",
          "enum": ["master", "worker"],
          "default": "worker",
          "description": "Node role"
        },
        "specs": {
          "type": "object",
          "properties": {
            "cpu_cores": {
              "type": "integer",
              "minimum": 2,
              "maximum": 128
            },
            "memory_gb": {
              "type": "integer",
              "minimum": 8,
              "maximum": 1024
            },
            "storage_gb": {
              "type": "integer",
              "minimum": 100,
              "maximum": 10000
            }
          }
        }
      }
    },
    "storage": {
      "type": "object",
      "required": ["id", "type", "path"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9-]+$",
          "description": "Storage ID"
        },
        "type": {
          "type": "string",
          "enum": ["dir", "nfs", "cifs", "lvm", "lvmthin", "zfspool", "cephfs", "rbd"],
          "description": "Storage type"
        },
        "path": {
          "type": "string",
          "description": "Storage path or mount point"
        },
        "content": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["images", "rootdir", "vztmpl", "backup", "iso", "snippets"]
          },
          "description": "Allowed content types"
        },
        "shared": {
          "type": "boolean",
          "default": false,
          "description": "Shared storage"
        },
        "nodes": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Nodes with access to this storage"
        }
      }
    }
  }
}